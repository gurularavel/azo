(()=>{function w(n){n.directive("mask",(e,{value:t,expression:o},{effect:s,evaluateLater:f,cleanup:l})=>{let r=()=>o,u="";queueMicrotask(()=>{if(["function","dynamic"].includes(t)){let i=f(o);s(()=>{r=d=>{let g;return n.dontAutoEvaluateFunctions(()=>{i(c=>{g=typeof c=="function"?c(d):c},{scope:{$input:d,$money:k.bind({el:e})}})}),g},a(e,!1)})}else a(e,!1);if(e._x_model){if(e._x_model.get()===e.value||e._x_model.get()===null&&e.value==="")return;e._x_model.set(e.value)}});const p=new AbortController;l(()=>{p.abort()}),e.addEventListener("input",()=>a(e),{signal:p.signal,capture:!0}),e.addEventListener("blur",()=>a(e,!1),{signal:p.signal});function a(i,d=!0){let g=i.value,c=r(g);if(!c||c==="false")return!1;if(u.length-i.value.length===1)return u=i.value;let _=()=>{u=i.value=h(g,c)};d?I(i,c,()=>{_()}):_()}function h(i,d){if(i==="")return"";let g=v(d,i);return b(d,g)}}).before("model")}function I(n,e,t){let o=n.selectionStart,s=n.value;t();let f=s.slice(0,o),l=b(e,v(e,f)).length;n.setSelectionRange(l,l)}function v(n,e){let t=e,o="",s={9:/[0-9]/,a:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},f="";for(let l=0;l<n.length;l++){if(["9","a","*"].includes(n[l])){f+=n[l];continue}for(let r=0;r<t.length;r++)if(t[r]===n[l]){t=t.slice(0,r)+t.slice(r+1);break}}for(let l=0;l<f.length;l++){let r=!1;for(let u=0;u<t.length;u++)if(s[f[l]].test(t[u])){o+=t[u],t=t.slice(0,u)+t.slice(u+1),r=!0;break}if(!r)break}return o}function b(n,e){let t=Array.from(e),o="";for(let s=0;s<n.length;s++){if(!["9","a","*"].includes(n[s])){o+=n[s];continue}if(t.length===0)break;o+=t.shift()}return o}function k(n,e=".",t,o=2){if(n==="-")return"-";if(/^\D+$/.test(n))return"9";t==null&&(t=e===","?".":",");let s=(u,p)=>{let a="",h=0;for(let i=u.length-1;i>=0;i--)u[i]!==p&&(h===3?(a=u[i]+p+a,h=0):a=u[i]+a,h++);return a},f=n.startsWith("-")?"-":"",l=n.replaceAll(new RegExp(`[^0-9\\${e}]`,"g"),""),r=Array.from({length:l.split(e)[0].length}).fill("9").join("");return r=`${f}${s(r,t)}`,o>0&&n.includes(e)&&(r+=`${e}`+"9".repeat(o)),queueMicrotask(()=>{this.el.value.endsWith(e)||this.el.value[this.el.selectionStart-1]===e&&this.el.setSelectionRange(this.el.selectionStart-1,this.el.selectionStart-1)}),r}document.addEventListener("alpine:init",()=>{window.Alpine.plugin(w)})})();
